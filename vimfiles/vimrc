syntax off

filetype plugin indent on

highlight PmenuSel ctermfg=white ctermbg=darkgray guifg=white guibg=darkgray
highlight Search   ctermfg=white ctermbg=darkgray guifg=white guibg=darkgray
highlight Visual   ctermfg=white ctermbg=darkgray guifg=white guibg=darkgray

let g:NERDTreeHijackNetrw = 1
let g:NERDTreeNodeDelimiter = "\u00a0" "remove ^G with `syntax off`
let g:NERDTreeShowHidden = 1
let g:NERDTreeStatusline = ""
let g:NERDTreeWinSize = 40
let g:ale_completion_enabled = 1
let g:ale_completion_max_suggestions = 5
let g:ale_go_gopls_options = "-telemetry.disable -mode=stdio -remote=auto -remote.listen.timeout=0"
let g:ale_history_enabled = 0
let g:ctrlp_map = ""
let g:ctrlp_match_current_file = 1
let g:ctrlp_match_window = "bottom,order:btt,min:1,max:10,results:0"
let g:loaded_netrwPlugin = 1
let g:mapleader = "\<Space>"
let g:skip_defaults_vim = 1
let g:ale_linters = {
  \'go': ['gopls'],
  \'php': ['langserver'],
  \'python': ['pyls'],
\}
let g:ale_fixers = {
  \'go': ['goimports'],
  \'php': ['php_cs_fixer'],
  \'python': ['black'],
\}

nnoremap <Leader>t <C-o>
nnoremap <Space> <NOP>
nnoremap q: <NOP> "disable noise features
nnoremap q? <NOP>
nnoremap qq <NOP>
noremap <Leader>Q :%bdelete!<CR> "force close all
noremap <Leader>[ :ALEFindReferences<CR>
noremap <Leader>] :ALEGoToDefinition<CR>
noremap <Leader>b :CtrlPBuffer<CR> "<C-f> switch mode
noremap <Leader>f :NERDTreeFind<CR>
noremap <Leader>g :terminal git blame -e -w --date short %<CR>
noremap <Leader>l :ALEFix<CR>
noremap <Leader>n :NERDTreeToggle<CR>
noremap <Leader>q :bdelete<CR>
noremap <Tab> :wincmd w<CR>

autocmd BufEnter * if bufname("#") =~# "^NERD_tree_" && winnr("$") > 1 | b# | endif

function! LinterStatus() abort
  try
    let l:counts = ale#statusline#Count(bufnr(''))
    let l:all_errors = l:counts.error + l:counts.style_error
    let l:all_non_errors = l:counts.total - l:all_errors
    return l:counts.total == 0 ? '' : printf('E:%d W:%d', l:all_errors, l:all_non_errors)
  catch
    return ''
  endtry
endfunction
if !has("nvim")
  set term=$TERM "Make arrow and other keys work
endif
if has("clipboard")
  set clipboard^=unnamed "On mac and Windows, use * register for copy-paste
  if has("unnamedplus")  "When possible use + register for copy-paste
    set clipboard^=unnamedplus
  endif
endif
if has("statusline")
  set laststatus=2
  set statusline=%<%f\ \%{\"[\".(&fenc==\"\"?&enc:&fenc).((exists(\"+bomb\")\ &&\ &bomb)?\",B\":\"\").\"]\"}%h%r%m%=\%{LinterStatus()}\ %l\:%P
endif
if $PAGER == "less" "for usefull `git blame` command
  let $PAGER = "cat"
endif

set background=light
set backspace=indent,eol,start
set belloff=all
set encoding=utf-8
set fileencodings=utf-8,cp1251,koi8-r,cp866
set fileformats=unix
set hidden
set history=5
set hlsearch
set ignorecase
set incsearch
set lazyredraw
set linebreak
set linespace=0
set list
set listchars=tab:•·,trail:•,nbsp:¤,extends:¦,precedes:¦
set matchtime=1
set mouse=a
set nobackup
set noerrorbells
set nofoldenable
set noswapfile
set notitle
set nowrap
set nowritebackup
set shortmess=atI
set showbreak=¬
set showmatch
set smartcase
set splitbelow
set splitright
set t_Co=256 "Enable 256 colors to stop the CSApprox warning and make xterm vim shine
set ttimeout
set ttimeoutlen=50
set ttyfast
set undolevels=8
set viminfo=""
set visualbell
set wildignorecase
set wildmode=list:longest

